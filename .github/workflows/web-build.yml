# ğŸŒ AIç®—å‘½å¤§å¸ˆ - Webç‰ˆæœ¬æ„å»ºæµ‹è¯•
name: Build Web Version

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-web:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ“± è®¾ç½®Node.jsç¯å¢ƒ
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: npm ci
      
    - name: ğŸ” æ£€æŸ¥é¡¹ç›®ç»“æ„
      run: |
        echo "ğŸ“‚ é¡¹ç›®æ ¹ç›®å½•ï¼š"
        ls -la
        echo ""
        echo "ğŸ“‹ Package.jsonè„šæœ¬ï¼š"
        cat package.json | grep -A 10 '"scripts"'
        echo ""
        echo "ğŸ“‚ æ£€æŸ¥å…³é”®æ–‡ä»¶ï¼š"
        [ -f "webpack.config.js" ] && echo "âœ… webpack.config.jså­˜åœ¨" || echo "âŒ webpack.config.jsä¸å­˜åœ¨"
        [ -f "index.html" ] && echo "âœ… index.htmlå­˜åœ¨" || echo "âŒ index.htmlä¸å­˜åœ¨"
        [ -f "index.web.js" ] && echo "âœ… index.web.jså­˜åœ¨" || echo "âŒ index.web.jsä¸å­˜åœ¨"
        
    - name: ğŸŒ æ„å»ºWebç‰ˆæœ¬
      run: |
        echo "ğŸš€ å¼€å§‹æ„å»ºWebç‰ˆæœ¬..."
        if npm run web:build; then
          echo "âœ… Webæ„å»ºæˆåŠŸï¼"
        else
          echo "âš ï¸ web:buildå¤±è´¥ï¼Œå°è¯•å…¶ä»–æ„å»ºæ–¹å¼..."
          if npm run web; then
            echo "âœ… Webè¿è¡ŒæˆåŠŸï¼"
          else
            echo "ğŸ“¦ ç›´æ¥ä½¿ç”¨webpackæ„å»º..."
            npx webpack --mode production
          fi
        fi
        
    - name: ğŸ§ª æµ‹è¯•Webç‰ˆæœ¬åŠŸèƒ½
      run: |
        echo "ğŸ§ª æµ‹è¯•å…³é”®æ–‡ä»¶å’ŒåŠŸèƒ½..."
        
        # æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†æ„å»ºäº§ç‰©
        if [ -d "dist" ]; then
          echo "âœ… distç›®å½•å­˜åœ¨"
          ls -la dist/
        fi
        
        if [ -d "build" ]; then
          echo "âœ… buildç›®å½•å­˜åœ¨"
          ls -la build/
        fi
        
        # æ£€æŸ¥index.htmlæ˜¯å¦åŒ…å«å…³é”®å†…å®¹
        if [ -f "index.html" ]; then
          echo "ğŸ” æ£€æŸ¥index.htmlå†…å®¹..."
          grep -q "AIç®—å‘½å¤§å¸ˆ" index.html && echo "âœ… åŒ…å«åº”ç”¨æ ‡é¢˜" || echo "âŒ ç¼ºå°‘åº”ç”¨æ ‡é¢˜"
          grep -q "Gemini" index.html && echo "âœ… åŒ…å«AIé›†æˆ" || echo "âŒ ç¼ºå°‘AIé›†æˆ"
        fi
        
    - name: ğŸ“¤ ä¸Šä¼ Webæ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: web-build
        path: |
          index.html
          dist/
          build/
        if-no-files-found: warn
        
    - name: ğŸ‰ æ„å»ºæˆåŠŸæŠ¥å‘Š
      run: |
        echo "ğŸŠ æ­å–œï¼AIç®—å‘½å¤§å¸ˆWebç‰ˆæœ¬æ„å»ºå®Œæˆï¼"
        echo ""
        echo "ğŸ“‹ æ„å»ºæ‘˜è¦ï¼š"
        echo "âœ… Node.jsç¯å¢ƒé…ç½®æˆåŠŸ"
        echo "âœ… ä¾èµ–å®‰è£…æˆåŠŸ"
        echo "âœ… Webç‰ˆæœ¬æ„å»ºæˆåŠŸ"
        echo "âœ… æ„å»ºäº§ç‰©ä¸Šä¼ æˆåŠŸ"
        echo ""
        echo "ğŸš€ ä¸‹ä¸€æ­¥ï¼šAndroid APKæ„å»º"
        echo "ğŸŒ Webç‰ˆæœ¬å·²ready for deploymentï¼"